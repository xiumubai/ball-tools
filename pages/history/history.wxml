<view class="page">
  <text class="rounds text-foreground">历史比赛 {{stats.total}}</text>
  <t-tabs value="{{filterTab}}" bind:change="onTabChange" class="tabbar" variant="card" size="small">
    <t-tab-panel value="all" label="全部"></t-tab-panel>
    <t-tab-panel value="eight" label="中八"></t-tab-panel>
    <t-tab-panel value="nine" label="追分"></t-tab-panel>
  </t-tabs>

  <view class="summary">
    <view class="summary-card bg-card border-border glass">
      <text class="summary-value text-foreground">{{stats.total}}</text>
      <text class="summary-label text-muted-foreground">总场次</text>
    </view>
    <view class="summary-card bg-card border-border glass">
      <text class="summary-value text-primary">{{stats.wins}}</text>
      <text class="summary-label text-muted-foreground">胜</text>
    </view>
    <view class="summary-card bg-card border-border glass">
      <text class="summary-value text-destructive">{{stats.losses}}</text>
      <text class="summary-label text-muted-foreground">负</text>
    </view>
    <view class="summary-card bg-card border-border glass">
      <text class="summary-value text-accent">{{stats.winRate}}</text>
      <text class="summary-label text-muted-foreground">胜率</text>
    </view>
  </view>

  <block wx:if="{{displayMatches.length==0}}">
    <view class="empty">
      <t-result theme="default" description="暂无比赛记录"></t-result>
    </view>
  </block>

  <scroll-view scroll-y style="flex:1">
    <block wx:for="{{displayMatches}}" wx:key="id">
      <view class="record bg-card border-border glass">
        <view class="record-header">
          <t-tag size="small" shape="round" variant="light" theme="{{item.type=='8球'?'success':'warning'}}">{{item.type}}</t-tag>
          <text class="time text-muted-foreground">{{item.date}} {{item.time}}</text>
          <text class="round text-muted-foreground">总局数 {{item.totalRounds}}</text>
        </view>

        <block wx:if="{{item.type=='8球'}}">
          <view class="players">
            <view class="player">
              <t-avatar image="{{avatars.A}}" size="128rpx" shape="circle"></t-avatar>
              <text class="name">{{item.players[0].name}}</text>
            </view>
            <view class="score">
              <text class="score-num a">{{item.players[0].score}}</text>
              <text class="dash">-</text>
              <text class="score-num b">{{item.players[1].score}}</text>
            </view>
            <view class="player">
              <t-avatar image="{{avatars.B}}" size="128rpx" shape="circle"></t-avatar>
              <text class="name">{{item.players[1].name}}</text>
            </view>
          </view>
          <view class="stats">
            <view class="stats-card bg-card border-border glass">
              <text class="stats-title">{{item.players[0].name}}</text>
              <view class="stats-items">
                <view class="stat"><text class="stat-label">犯规</text><t-tag size="small" shape="round" variant="light" theme="danger">{{item.players[0].stats.fouls}}</t-tag></view>
                <view class="stat"><text class="stat-label">普胜</text><t-tag size="small" shape="round" variant="light" theme="success">{{item.players[0].stats.normalWin}}</t-tag></view>
                <view class="stat"><text class="stat-label">接清</text><t-tag size="small" shape="round" variant="light" theme="primary">{{item.players[0].stats.clearWin}}</t-tag></view>
                <view class="stat"><text class="stat-label">炸清</text><t-tag size="small" shape="round" variant="light" theme="warning">{{item.players[0].stats.breakClear}}</t-tag></view>
              </view>
            </view>
            <view class="stats-card bg-card border-border glass">
              <text class="stats-title">{{item.players[1].name}}</text>
              <view class="stats-items">
                <view class="stat"><text class="stat-label">犯规</text><t-tag size="small" shape="round" variant="light" theme="danger">{{item.players[1].stats.fouls}}</t-tag></view>
                <view class="stat"><text class="stat-label">普胜</text><t-tag size="small" shape="round" variant="light" theme="success">{{item.players[1].stats.normalWin}}</t-tag></view>
                <view class="stat"><text class="stat-label">接清</text><t-tag size="small" shape="round" variant="light" theme="primary">{{item.players[1].stats.clearWin}}</t-tag></view>
                <view class="stat"><text class="stat-label">炸清</text><t-tag size="small" shape="round" variant="light" theme="warning">{{item.players[1].stats.breakClear}}</t-tag></view>
              </view>
            </view>
          </view>
        </block>

        <block wx:elif="{{item.type=='9球'}}">
          <view class="zplayers {{item.players.length==2?'two':'three'}}">
            <block wx:for="{{item.players}}" wx:key="name" wx:for-index="idx" wx:for-item="p">
              <view class="player">
                <t-avatar image="{{zhuifenAvatars[idx]}}" size="128rpx" shape="circle"></t-avatar>
                <text class="name">{{p.name}}</text>
                <text class="score-num">{{p.score}}</text>
              </view>
            </block>
          </view>
          <view class="zstats {{item.players.length==2?'two':'three'}}">
            <block wx:for="{{item.players}}" wx:key="name" wx:for-index="idx" wx:for-item="p">
              <view class="stats-card bg-card border-border glass">
                <text class="stats-title">{{p.name}}</text>
                <view class="stats-items {{item.players.length==2?'two':'three'}}">
                  <view class="stat"><text class="stat-label">犯规</text><t-tag size="small" shape="round" variant="light" theme="danger">{{p.stats.fouls}}</t-tag></view>
                  <view class="stat"><text class="stat-label">普胜</text><t-tag size="small" shape="round" variant="light" theme="success">{{p.stats.normalWin}}</t-tag></view>
                  <view class="stat"><text class="stat-label">小金</text><t-tag size="small" shape="round" variant="light" theme="primary">{{p.stats.smallGold}}</t-tag></view>
                  <view class="stat"><text class="stat-label">大金</text><t-tag size="small" shape="round" variant="light" theme="primary">{{p.stats.bigGold}}</t-tag></view>
                  <view class="stat"><text class="stat-label">黄金9</text><t-tag size="small" shape="round" variant="light" theme="primary">{{p.stats.golden9}}</t-tag></view>
                </view>
              </view>
            </block>
          </view>
        </block>

      </view>
    </block>
  </scroll-view>
</view>
