<view class="app">
  <!-- 分享卡片（用于生成图片的画布） -->
  <view class="share-canvas">
    <view class="watermark"><text>追分记</text></view>

    <view class="card-inner">
      <!-- 品牌/水印角标 -->
      <view class="brand">
        <view class="logo">
          <t-icon name="application" size="36rpx" color="#EAF0FF" />
        </view>
        <view class="name">Generated by Ball Tools</view>
      </view>

      <!-- 标题与元信息 -->
      <view class="title">
        <view class="h1">{{type}} 战报</view>
        <view class="meta">
          <view class="meta-item">
            <t-icon name="calendar" size="28rpx" style="margin-right:8rpx;" />
            <text>{{date}} {{time}}</text>
          </view>
          <view class="meta-item">
            <t-icon name="chart" size="28rpx" style="margin-right:8rpx;" />
            <text>总局数: {{totalRounds}}</text>
          </view>
        </view>
      </view>

      <!-- 分数看板 -->
      <view class="scoreboard">
        <block wx:for="{{players}}" wx:key="name">
          <view class="score">
            <view class="num">{{item.score}}</view>
            <view class="label">
              <t-icon name="user" size="24rpx" style="margin-right:6rpx;" />
              <text>{{item.name}}</text>
            </view>
          </view>
        </block>
      </view>

      <view class="divider"></view>

      <!-- 统计表 -->
      <view class="table-container">
        <view class="table-header">
          <view class="th text-left">统计项</view>
          <block wx:for="{{players}}" wx:key="name">
            <view class="th text-center">{{item.name}}</view>
          </block>
        </view>
        <view class="table-body">
          <block wx:for="{{statsRows}}" wx:key="label">
            <view class="tr">
              <!-- 图标逻辑：根据 label 显示不同图标 -->
              <view class="td text-left tag-cell {{item.label==='普胜'?'tag-win':(item.label==='犯规'?'tag-fault':'')}}">
                <t-icon wx:if="{{item.label==='普胜'}}" name="trophy" size="28rpx" style="margin-right:8rpx;" />
                <t-icon wx:elif="{{item.label==='接清'}}" name="check-circle" size="28rpx" style="margin-right:8rpx;" />
                <t-icon wx:elif="{{item.label==='炸清'}}" name="error-circle" size="28rpx" style="margin-right:8rpx;" />
                <t-icon wx:elif="{{item.label==='犯规'}}" name="close-circle" size="28rpx" style="margin-right:8rpx;" />
                <t-icon wx:else name="bulletpoint" size="28rpx" style="margin-right:8rpx;" />
                <text>{{item.label}}</text>
              </view>
              <block wx:for="{{item.values}}" wx:key="idx" wx:for-item="val">
                <view class="td text-center bold">{{val}}</view>
              </block>
            </view>
          </block>
        </view>
      </view>

      <view class="card-footer">—— 追分记 · 分享战报 ——</view>
    </view>
  </view>

  <!-- 底部操作栏 -->
  <view class="actions">
    <button class="btn" hover-class="btn-hover" bindtap="saveCard">
      <t-icon name="download" size="36rpx" style="margin-right:12rpx;" />
      <text>保存战报到相册</text>
    </button>
  </view>

  <!-- 隐藏的 Canvas用于生成图片 -->
  <canvas type="2d" id="shareCanvas" style="position: fixed; left: -9999px; top: 0; width: 375px; height: 667px;" />
</view>
