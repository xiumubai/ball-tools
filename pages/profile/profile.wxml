<view class="container cn-padding">
  <!-- Header -->
  <view class="header">
    <text class="h1">设置</text>
    <text class="p">管理您的数据和应用偏好</text>
  </view>

  <!-- 功能入口 Section -->
  <view class="section">
    <view class="section-title">
      <t-icon name="app" size="28rpx" class="icon" />
      <text>功能</text>
    </view>
    <view class="card">
      <view class="menu-item" bindtap="goPlaytimeHistory">
        <view class="menu-icon blue">
          <t-icon name="time" size="40rpx" />
        </view>
        <view class="menu-content">
          <view class="title">打球时长记录</view>
          <view class="desc">查看历史训练时间和次数</view>
        </view>
        <text class="menu-value">{{totalPlayText}}</text>
        <t-icon name="chevron-right" size="40rpx" class="menu-arrow" />
      </view>
      
      <view class="menu-item" bindtap="goTraining">
        <view class="menu-icon green">
          <t-icon name="flag-2" size="40rpx" />
        </view>
        <view class="menu-content">
          <view class="title">去训练</view>
          <view class="desc">开始新的训练课程</view>
        </view>
        <t-icon name="chevron-right" size="40rpx" class="menu-arrow" />
      </view>
      <view class="menu-item" bindtap="goTactic">
        <view class="menu-icon orange">
          <t-icon name="edit-1" size="40rpx" />
        </view>
        <view class="menu-content">
          <view class="title">战术画板</view>
          <view class="desc">复盘局面，模拟走位，提升球技</view>
        </view>
        <t-icon name="chevron-right" size="40rpx" class="menu-arrow" />
      </view>
    </view>
  </view>

  <!-- 数据管理 Section -->
  <view class="section">
    <view class="section-title">
      <t-icon name="data-base" size="28rpx" class="icon" />
      <text>数据管理</text>
    </view>
    <view class="card">
      <view class="warning-box">
        <t-icon name="error-circle" size="36rpx" class="icon" />
        <text class="p">本应用采用离线模式，数据保存在本地存储中。清除缓存将导致所有记录数据永久丢失。请谨慎操作！</text>
      </view>
      
      <view class="menu-item" bindtap="onExportData">
        <view class="menu-icon amber">
          <t-icon name="download" size="40rpx" />
        </view>
        <view class="menu-content">
          <view class="title">导出数据</view>
          <view class="desc">备份您的训练记录</view>
        </view>
        <t-icon name="chevron-right" size="40rpx" class="menu-arrow" />
      </view>
      
      <view class="menu-item" bindtap="onImportData">
        <view class="menu-icon blue">
          <t-icon name="upload" size="40rpx" />
        </view>
        <view class="menu-content">
          <view class="title">导入数据</view>
          <view class="desc">从备份文件恢复</view>
        </view>
        <t-icon name="chevron-right" size="40rpx" class="menu-arrow" />
      </view>
      
      <view class="danger-item">
        <view class="danger-info">
          <t-icon name="delete" size="40rpx" class="icon" />
          <view class="text">
            <view class="title">清除所有数据</view>
            <view class="desc">此操作不可恢复</view>
          </view>
        </view>
        <button class="btn-danger" bindtap="onClearAll">清除</button>
      </view>
    </view>
  </view>

  <!-- 关于 Section -->
  <view class="section">
    <view class="section-title">
      <t-icon name="info-circle" size="28rpx" class="icon" />
      <text>关于</text>
    </view>
    <view class="card">
      <view class="menu-item" bindtap="onShowContact">
        <view class="menu-icon green">
          <t-icon name="chat" size="40rpx" />
        </view>
        <view class="menu-content">
          <view class="title">联系作者</view>
          <view class="desc">意见反馈 / 找我打球</view>
        </view>
        <t-icon name="chevron-right" size="40rpx" class="menu-arrow" />
      </view>
      <view class="info-item">
        <text class="label">当前版本</text>
        <text class="tag green">{{version}}</text>
      </view>
      <view class="info-item">
        <text class="label">开发者</text>
        <text class="value">{{author}}</text>
      </view>
      <view class="info-item" bindtap="onCopyRepo">
        <text class="label">简介</text>
        <text class="value">{{desc}}</text>
      </view>
    </view>
  </view>

  <!-- Footer -->
  <view class="footer">
    <text>Made with ♥ for billiard lovers</text>
  </view>

  <!-- 自定义二维码预览弹窗 -->
  <view class="qr-modal" wx:if="{{showImagePreview}}" bindtap="onCloseImagePreview">
    <view class="qr-container" catchtap="preventBubble">
      <image 
        src="{{previewImages[0]}}" 
        mode="widthFix" 
        show-menu-by-longpress="{{true}}" 
        class="qr-image"
      />
      <view class="qr-tip">长按识别/保存二维码</view>
    </view>
    <view class="close-btn" catchtap="onCloseImagePreview">
      <t-icon name="close-circle" size="64rpx" color="#fff" />
    </view>
  </view>
</view>
