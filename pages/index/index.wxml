<view class="page">
  <t-notice-bar visible="{{true}}" prefixIcon="{{false}}" content="长按玩家头像可修改玩家名称">
    <view slot="prefix-icon">
      <t-icon name="error-circle-filled"></t-icon>
    </view>
  </t-notice-bar>
  <view class="topbar">
    <text class="rounds">总局数 {{rounds}}</text>
    <t-button style="width: 128rpx;" size="small" theme="default" disabled="{{history.length == 0}}" bindtap="onUndo">撤销</t-button>
    <t-button style="width: 128rpx;" size="small" theme="default" bindtap="onRestart">重新开始</t-button>
  </view>
  <text class="lastop" wx:if="{{lastOpText}}">上一操作：{{lastOpText}}</text>

  <view class="players">
    <view class="player player-a {{selectedPlayer==='A'?'selected':''}}" bindtap="selectA" bindlongpress="onRenameStart" data-target="A">
      <t-avatar image="{{avatars.A}}" size="128rpx" shape="circle"></t-avatar>
      <text class="name">{{names.A}}</text>
    </view>

    <view class="score">
      <text class="score-num a">{{players.A.score}}</text>
      <text class="dash">-</text>
      <text class="score-num b">{{players.B.score}}</text>
    </view>

    <view class="player player-b {{selectedPlayer==='B'?'selected':''}}" bindtap="selectB" bindlongpress="onRenameStart" data-target="B">
      <t-avatar image="{{avatars.B}}" size="128rpx" shape="circle"></t-avatar>
      <text class="name">{{names.B}}</text>
    </view>
  </view>

  

  <view class="ops">
    <t-button block size="large" theme="danger" bindtap="onOp" data-type="foul">犯规</t-button>
    <t-button block size="large" theme="default" bindtap="onOp" data-type="normal">普胜</t-button>
    <t-button block size="large" theme="light" bindtap="onOp" data-type="jieqing">接清</t-button>
    <t-button block size="large" theme="primary" bindtap="onOp" data-type="zhaqing">炸清</t-button>
  </view>

  <view class="rename-mask" wx:if="{{renameVisible}}">
    <view class="rename-dialog">
      <text class="rename-title">修改玩家姓名</text>
      <input class="rename-input" type="text" placeholder="请输入中文姓名" value="{{renameValue}}" bindinput="onRenameInput" confirm-type="done" />
      <view class="rename-actions">
        <button class="rename-btn cancel" bindtap="onRenameCancel">取消</button>
        <button class="rename-btn ok" type="primary" bindtap="onRenameSave">保存</button>
      </view>
    </view>
  </view>

  <view class="stats">
    <view class="stats-card">
      <text class="stats-title">{{names.A}}</text>
      <view class="stats-items">
        <view class="stat"><text class="stat-label">犯规</text><t-tag size="small" shape="round" variant="light" theme="danger">{{players.A.foul}}</t-tag></view>
        <view class="stat"><text class="stat-label">普胜</text><t-tag size="small" shape="round" variant="light" theme="success">{{players.A.normal}}</t-tag></view>
        <view class="stat"><text class="stat-label">接清</text><t-tag size="small" shape="round" variant="light" theme="primary">{{players.A.jieqing}}</t-tag></view>
        <view class="stat"><text class="stat-label">炸清</text><t-tag size="small" shape="round" variant="light" theme="warning">{{players.A.zhaqing}}</t-tag></view>
      </view>
    </view>
    <view class="stats-card">
      <text class="stats-title">{{names.B}}</text>
      <view class="stats-items">
        <view class="stat"><text class="stat-label">犯规</text><t-tag size="small" shape="round" variant="light" theme="danger">{{players.B.foul}}</t-tag></view>
        <view class="stat"><text class="stat-label">普胜</text><t-tag size="small" shape="round" variant="light" theme="success">{{players.B.normal}}</t-tag></view>
        <view class="stat"><text class="stat-label">接清</text><t-tag size="small" shape="round" variant="light" theme="primary">{{players.B.jieqing}}</t-tag></view>
        <view class="stat"><text class="stat-label">炸清</text><t-tag size="small" shape="round" variant="light" theme="warning">{{players.B.zhaqing}}</t-tag></view>
      </view>
    </view>
  </view>

  <view class="bottombar">
    <button class="end" type="primary" bindtap="onEndMatch">结束比赛</button>
  </view>

  <t-fab icon="icon" button-props="{{fabButton}}" bind:click="handleRecord" />

</view>
